"use strict";var CPlayer=function(){var r,n,i,t,e,a=function(r){return Math.sin(6.283184*r)},f=function(r){return.003959503758*2**((r-128)/12)},o=function(r,n,i){var t,e,a,o,c,v,h=u[r.i[0]],s=r.i[1],w=r.i[3]/32,g=u[r.i[4]],l=r.i[5],y=r.i[8]/32,A=r.i[9],M=r.i[10]*r.i[10]*4,L=r.i[11]*r.i[11]*4,d=r.i[12]*r.i[12]*4,p=1/d,C=-r.i[13]/16,D=r.i[14],I=i*2**(2-r.i[15]),m=new Int32Array(M+L+d),B=0,P=0;for(t=0,e=0;t<M+L+d;t++,e++)e>=0&&(e-=I,c=f(n+(15&(D=D>>8|(255&D)<<4))+r.i[2]-128),v=f(n+(15&D)+r.i[6]-128)*(1+8e-4*r.i[7])),a=1,t<M?a=t/M:t>=M+L&&(a=(1-(a=(t-M-L)*p))*3**(C*a)),o=h(B+=c*a**w)*s,o+=g(P+=v*a**y)*l,A&&(o+=(2*Math.random()-1)*A),m[t]=80*o*a|0;return m},u=[a,function(r){return r%1<.5?1:-1},function(r){return r%1*2-1},function(r){var n=r%1*4;return n<2?n-1:3-n}];this.init=function(a){r=a,n=a.endPattern,i=0,t=a.rowLen*a.patternLen*(n+1)*2,e=new Int32Array(t)},this.generate=function(){var f,c,v,h,s,w,g,l,y,A,M,L,d,p,C=new Int32Array(t),D=r.songData[i],I=r.rowLen,m=r.patternLen,B=0,P=0,U=!1,W=[];for(v=0;v<=n;++v)for(g=D.p[v],h=0;h<m;++h){var b=g?D.c[g-1].f[h]:0;b&&(D.i[b-1]=D.c[g-1].f[h+m]||0,b<17&&(W=[]));var j=u[D.i[16]],k=D.i[17]/512,q=2**(D.i[18]-9)/I,x=D.i[19],z=D.i[20],E=43.23529*D.i[21]*3.141592/44100,F=1-D.i[22]/255,G=1e-5*D.i[23],H=D.i[24]/32,J=D.i[25]/512,K=6.283184*2**(D.i[26]-9)/I,N=D.i[27]/255,O=D.i[28]*I&-2;for(M=(v*m+h)*I,s=0;s<4;++s)if(w=g?D.c[g-1].n[h+s*m]:0){W[w]||(W[w]=o(D,w,I));var Q=W[w];for(c=0,f=2*M;c<Q.length;c++,f+=2)C[f]+=Q[c]}for(c=0;c<I;c++)(A=C[l=2*(M+c)])||U?(L=E,x&&(L*=j(q*l)*k+.5),P+=(L=1.5*Math.sin(L))*(d=F*(A-P)-(B+=L*P)),A=3==z?P:1==z?d:B,G&&(A=(A*=G)<1?A>-1?a(.25*A):-1:1,A/=G),U=(A*=H)*A>1e-5,p=A*(1-(y=Math.sin(K*l)*J+.5)),A*=y):p=0,l>=O&&(p+=C[l-O+1]*N,A+=C[l-O]*N),C[l]=0|p,C[l+1]=0|A,e[l]+=0|p,e[l+1]+=0|A}return++i/r.numChannels},this.createAudioBuffer=function(r){for(var n=r.createBuffer(2,t/2,44100),i=0;i<2;i++)for(var a=n.getChannelData(i),f=i;f<t;f+=2)a[f>>1]=e[f]/65536;return n},this.createWave=function(){var r=44+2*t-8,n=r-36,i=new Uint8Array(44+2*t);i.set([82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255]);for(var a=0,f=44;a<t;++a){var o=e[a];o=o<-32767?-32767:o>32767?32767:o,i[f++]=255&o,i[f++]=o>>8&255}return i},this.getData=function(r,n){for(var i=2*Math.floor(44100*r),t=new Array(n),a=0;a<2*n;a+=1){var f=i+a;t[a]=r>0&&f<e.length?e[f]/32768:0}return t}};
